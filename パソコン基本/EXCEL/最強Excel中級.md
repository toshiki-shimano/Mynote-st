# Excel中級

## Excelお作法

①業務上のデータを触る、入力する時はいつでも元の状態に戻せるように連番保存をしてから作業すること

②Excelのデータは、基本列の上下でレコードが変わり、行は同じデータのまとまりを指すように作成する（並び替えもしやすい）

## データテーブル

★融資に関わること、リース料金の比較や来期の営業計画を立てる上で、関連する複数の条件を色々と変更しながら十分に試算することが重要であり、その時にはデータテーブルを使い、「感度分析」を実現（複数の条件が変動した場合に結果がどのように変わるかを見る）


◍メモ
⇒月利は、年利を１２で割って出す 月利(%) = 年利(%) / 12
🔶重要🔶：PMT関数は、利率が一定であると仮定した場合の、元利均等の毎月の支払額を計算することができる（元利均等返済）

⇒pmt関数の使用例
⇒PMT(利率, 期間, 現在価値, [将来価値], [支払期日])

=PMT(B1/12, B2*12, B3) 結果：-66,679（pmtだけだとマイナスで表示されるので、-pmtと付けておけばプラス表示になる）

利率(年):2.50%[B1]
借入期間(年):15[B2]
借入金額:10,000,000[B3]

~説明~
1,000万円を年利2.5％の15年ローン、元利均等返済で借りた場合の毎月の支払額を求める。（年利のため12で割って月の利率を求め、借入期間を12倍して月回数にしている。）支払いの場合の計算結果はマイナスで表示される。
⇒なので、pmt関数にマイナスを付けておけばプラスで表示される

◍ミニ豆知識
>借金は利息をつけて支払う。利息は「元金×利率×借り入れをしている期間」で計算されます。貸金業者からの借り入れは利率については年利で表示されていますが、返済は毎月行うのが通常なので、実際に支払う場合には一日ごとの利息を元金と年利で計算して支払う期間を乗じて計算します。
利息は金利・利子といった言葉とイコールです。利息は、元金に一定の割合を掛け算して求めますが、その割合の事を利率と呼びます。貸金業者から借り入れをする場合には、1年で何パーセントの利率となるかという表記をされているため、「年利」という言われ方をします。
貸金業者から借り入れをする際には、返済の際に利息がかかるだけではなく、保証料・手数料といったものが発生することになります。利息も保証料も手数料も貸金業者の利益になるという観点からは変わらないので、こういったものも含めて利息を考えるべきです。そのため、保証料・手数料を含んだ年利の事を実質年率と呼んでいます。
利息の支払いは、（元金×実質年利）÷365×返済までの日数で求めます。
では、年利がわかった場合に実際に支払う利息の額をどのようにして計算するのでしょうか。
この計算は（元金×実質年利）÷365×返済までの日数で求めます。たとえば、元金が50万円で実質年利が16%、30日分の利息を計算する場合には、（500,000×16%）÷365×30＝6,575円になります。
例えばこの条件で一カ月に1万円ずつ返そうとしたら、利息、元本の順に充当されるため、10,000円のうち6,575円が利息として受け取られて、残りの3,425円が元本へ充当されます。ですので、次回の支払いは500,000-3,425＝496,548円を元本として計算をすることになります。
｢利息｣は、元金×金利×借入期間で計算されます。
「元金」とは、借りた金額のこと。元本ともいいます。
「金利」とは、元金に対して一定期間に支払う利息の割合のことです。
実際に利息を計算してみましょう。
例えば、10万円を年利10％で半年間借りるとすると、その利息は次
のようになります。
金利10％は、百分率だと0.1です。
金利は、ふつう「年利」といって１年間の利息の割合で表されるので、
借入期間も年単位にあわせると、半年（ 6ヵ月）は6/12になります。
利息はお金の利用料！
［元金］   ［金利］［借入期間］ ［利息］
10 0,0 0 0円 × 0.1 × 6/12 ＝ 5,0 0 0円
いくらになるか、計算してみよう！
Q8 銀行などの金融機関から30万円を年利10％で1ヵ月間借りたとして、その利息を計算してみましょう。
利息＝元金（ ）円×金利（ ）％×1/100×借入期間（  /12 ）年＝（  ）

～以上を基本としてデータテーブルへ～

* 例として、銀行より融資を受けた時のパターンをそれぞれ見る  

1. 返済期間は3，4，5年のいずれか

2. 借入金額は1000万円、1300万円、1500万円のいずれか

3. 金利は年利2％、月々の返済額は30万円以下に押さえたい

⇒返済期間と借入期間は3 * 3で9パターンある

◍借入金額：10,000,000  
◍金利：2.0%  
◍返済期間：4  
⇒このセルだと毎回1つしか調べることができない。データテーブルを使うと、数式に含まれる１つ、または２つの値が変動した際に、その計算結果がどのように変化するかを一覧で確認できます。今回でいえば、返済期間と借入金額の２つが変動

★データテーブルの作成  
①まず「ある条件での試算結果」を記入した表を作成
⇒PMT(利率（ローンの利率）, 期間（支払回数）, 現在価値（現在の借入金額）, [将来価値], [支払期日]（一回当たりの支払額を求める式）  
⇒=-PMT(F6/12, F7 * 12, F5)  
⇒利率は、月利にしている。期間は、4年なら、12を掛けると何カ月かわかる（つまり両方とも月単位にしている）  

②データテーブル用の表を作成し、見出し列はカラムを、行はレコードになるようにする

|F4|1000万円|1300万円|1500万円|
|---|---|---|---|
|3||||
|4||||
|5||||

⇒F4のちょうど表の左のクロスしたところに、計算して求めた値のセルを入れる

③見出し列と見出し行を含めて範囲選択して、データタブのwhat-if分析のデータテーブルを選択
⇒「Alt」「a」「w」「t」
🔶重要🔶：ここで変更がされる二つの値を指すセルをそれぞれ絶対参照で指定
⇒行に借入金額を書いているなら、行に借入金額の値のセルを絶対参照で入力
⇒行：$F$5、列：$F$7  
⇒すると表にその計算される
🔺注意🔺:表の端っこの値（F4）は削除すると値が全て変わってしまうので、文字色を白にして見えないようにする

★ここでまとめ
⇒データテーブルは、あるno規則性沿って計算された表の一つか二つの値をとって、その値が変更された時の結果をマトリクスに置くことでその値の変更値によって計算をしてくれる。イメージは収支計画表（p218）がわかりやすい
🔶重要🔶：参照元表から選ぶ値は、「ベタ打ちされている数値のみ」（つまり、数式が入力されているセルは選択しない）そして、マトリクスに打つのは、数式。
🔶重要🔶：参照元の表に新たに行や列の挿入をした場合に、その範囲にデータテーブルがあると影響を受けるので、参照元表の右下斜めに作成することがいい

◍参照元表があり
変更される値１
変更される値２
計算結果

◍参照元のデータテーブル
🔹参考🔹：ここに条件付き書式(ホームタブ)で、この値以上は緑。この値以下は赤とするとさらにわかりやすい。

|見たい計算結果|変更される値１の違う値|変更される値１の違う値|変更される値１の違う値|
|---|---|---|---|
|変更される値２の違う値||||
|変更される値２の違う値||||
|変更される値２の違う値||||

～データテーブル補足～

★データテーブルの計算する列や行が10 * 10 くらいになってくると100通りの計算になるのでExcelが非常に重くなる。参照元表がデータテーブルの対象値をどこか変える度に100の計算をするので非常に効率が悪くなる  
⇒これを解決するには、「データテーブルの自動計算をオフにする（数式タブの計算方法でデータテーブル以外を自動にする）  
⇒また、これを再計算できるようにするためには、「再計算実行」を押す。元に戻すには計算方法の自動を選ぶ

## ゴールシーク

★希望の計算値を出すために逆算する機能  
⇒客単価が500円、客数が200人のとき、一日の売り上げは100000円  
⇒では、12万円を達成したい時に必要な客数は何人か？(500x = 120000)  

★データタブでwhat-if分析のゴールシーク（Alt,a,w）  
◍100000  
◍500  
◍200  

⇒数式入力セルは、100000の式があるセルを絶対参照で  
⇒目標値は、自身で設定  
⇒🔶重要🔶：変化させるセルは、つまり実際に目標値を達成するに時に必要な値を死食べたい時に項目を選択する。この場合は200になる
・この中で設定されなかった客単価は固定され、式の結果に対しての部品の中で変更される値を出すことができる
🔺注意🔺:因みに、目標値は、直接入力でセル参照はできない。変化させる値はベタ打ちの数字しか選択できない。

★ゴールシークで役に立つのは、複雑な計算の時！
⇒例えば、利益300万円の収支利益表があり、利益を400万円にしたい（目標値）時に、例えば、一人当たりの人件費をいくらにすればいいか考えたい時（変化させるセル）、、
◍数式入力セル：300万円の式があるセル
◍目標値：自身で設定、400万円
◍変化させるセル：一人当たりの人件費のセル

⇒🔶重要🔶：これで計算ができる。つまり、利益は多くの数式があっての最終的な結果だが、その多くの数式の一部をｘとするのは、自身でそれに関わる数式を徳野は時間がかかるため、便利である。  
🔺注意🔺:つまり、元の数式が正しく計算されていることが絶対条件

★シナリオ機能（データタブのwhat-if分析）
⇒利益収支表である値とある値をこの数字変えたら最終的な利益がどうなるかというシナリオを登録できる。例えば、2018年の材料費率と2019年の材料費率がそれぞれ20％、30％の時という値の登録をしておけば、そのシナリオを呼び出せば、いちいちそのセルを選択して数値を変えなくていい





